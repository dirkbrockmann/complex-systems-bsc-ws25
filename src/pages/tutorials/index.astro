---
// This page builds the tutorials listing. Rationale:
// - Tutorials are a small, curated set so we render them on a single index page (no pagination).
// - Routes for individual tutorials are generated by `src/pages/tutorials/[id].astro` which
//   uses `getCollection('tutorials')` in its `getStaticPaths()` to produce per-tutorial routes.
// - Keep this page simple: fetch the collection, render a preamble entry and show previews.
// If the tutorial count grows later, consider adding `src/pages/tutorials/[...page].astro` and
// using `paginate()` to split the archive into pages.
import { getCollection, getEntry, render } from 'astro:content';
import Link from '../../components/Link.astro';
import TutorialPreview from '../../components/TutorialPreview.astro';
import ListLayout from '../../layouts/ListLayout.astro';
import { sortItemsByDateDesc } from '../../utils/data-utils';

const tutorials = (await getCollection('tutorials')).filter((tutorial) => !tutorial.data.draft).sort(sortItemsByDateDesc);
const preamble = await getEntry('pages', 'tutorials');
// Safe accessors for preamble metadata (avoid TypeScript complaints if entry missing)
const title = preamble?.data?.title ?? 'Tutorials';
const image = (preamble?.data as any)?.image;
const showHeader = preamble?.data?.showHeader ?? false;
const { Content } = preamble ? await render(preamble) : { Content: () => '' };
---

<ListLayout title={title} image={image} showHeader={showHeader}>
    <div slot="preamble">
        <Content components={{ a: Link }} />
    </div>
    
    <div slot="list">
        {tutorials.map((tutorial) => <TutorialPreview tutorial={tutorial} class="mb-10 sm:mb-12" />)}
    </div>
</ListLayout>
